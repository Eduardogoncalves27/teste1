<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Eduardo & Amanda</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: linear-gradient(135deg, #f7f4ff, #ffffff);
  color: #444;
  text-align: center;
  padding: 20px;
  overflow-x: hidden;
}
.container { max-width: 480px; margin: auto; position: relative; }
h1 { color: #6a4bc3; }
p { font-size: 16px; line-height: 1.5; }
.hidden { display: none; }
.preview img,
.preview video { width: 100%; border-radius: 12px; margin-top: 15px; }
button {
  width: 100%;
  padding: 16px;
  margin-top: 12px;
  font-size: 16px;
  border-radius: 10px;
  border: none;
  cursor: pointer;
}
.start { background: #6a4bc3; color: #fff; }
.send { background: #2e7d32; color: #fff; }
.retry { background: #e0e0e0; }
.success { margin-top: 30px; font-size: 20px; color: #2e7d32; position: relative; z-index: 2; }
.progress-bar {
  width: 100%;
  height: 16px;
  background: #e0e0e0;
  border-radius: 8px;
  overflow: hidden;
  margin-top: 12px;
  transition: opacity 0.3s;
  opacity: 0;
}
.progress {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, #6a4bc3, #9b6ef2);
  border-radius: 8px;
  transition: width 0.5s ease-in-out;
}
.honeypot { display: none; }

/* Canvas do confete 3D colorido */
#confetti-canvas {
  position: fixed;
  pointer-events: none;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 1;
}
</style>
</head>

<body>
<div class="container">

<div id="welcome">
  <h1>üíç Eduardo & Amanda</h1>
  <p>
    Obrigado por celebrar conosco ‚ù§Ô∏è<br>
    Clique no bot√£o abaixo para tirar sua foto ou gravar seu v√≠deo!
  </p>
  <button id="startCamera" class="start">üì∏ Come√ßar</button>
</div>

<div id="cameraChoice" class="hidden">
  <p>Escolha a c√¢mera:</p>
  <button onclick="abrirCamera('user')">üì∑ Frontal</button>
  <button onclick="abrirCamera('environment')">üì∏ Traseira</button>
</div>

<form
  id="form"
  action="https://formsubmit.co/eduardo.goncalves27@gmail.com"
  method="POST"
  enctype="multipart/form-data"
  class="hidden"
>
  <input type="hidden" name="_captcha" value="false">
  <input type="hidden" name="_subject" value="Casamento Eduardo & Amanda - M√≠dia enviada">
  <input type="text" name="_honey" class="honeypot" tabindex="-1" autocomplete="off">
  <input
    id="file"
    type="file"
    name="arquivo"
    accept="image/*,video/*"
    capture
    class="hidden"
    required
  >

  <div id="preview" class="preview hidden"></div>
  <div id="actions" class="hidden">
    <button type="submit" class="send">üì§ Enviar</button>
    <button type="button" class="retry" onclick="resetar()">üîÑ Refazer</button>
  </div>

  <div class="progress-bar">
    <div class="progress" id="progress"></div>
  </div>
</form>

<div id="success" class="success hidden">
  ‚úÖ <strong>SALVO E ENVIADO!</strong><br><br>
  Muito obrigado por compartilhar esse momento especial üíñ<br>
  Sua foto j√° pode aparecer na TV!
</div>

<canvas id="confetti-canvas"></canvas>
</div>

<script>
const startButton = document.getElementById("startCamera");
const cameraChoice = document.getElementById("cameraChoice");
const file = document.getElementById("file");
const preview = document.getElementById("preview");
const actions = document.getElementById("actions");
const welcome = document.getElementById("welcome");
const success = document.getElementById("success");
const form = document.getElementById("form");
const progressBar = document.querySelector(".progress-bar");
const progress = document.getElementById("progress");

// In√≠cio
startButton.onclick = () => {
  welcome.classList.add("hidden");
  cameraChoice.classList.remove("hidden");
};

// Abrir c√¢mera
function abrirCamera(facingMode) {
  file.setAttribute("capture", facingMode);
  file.click();
}

// Arquivo selecionado
file.onchange = () => {
  const f = file.files[0];
  if (!f) return; // cancelou

  cameraChoice.classList.add("hidden");
  form.classList.remove("hidden");

  if (f.size > 30 * 1024 * 1024) {
    alert("O arquivo deve ter no m√°ximo 30MB.");
    resetar();
    return;
  }

  preview.innerHTML = "";
  let media;
  if (f.type.startsWith("image")) {
    media = document.createElement("img");
    media.src = URL.createObjectURL(f);
  } else {
    media = document.createElement("video");
    media.src = URL.createObjectURL(f);
    media.controls = true;
  }

  preview.appendChild(media);
  preview.classList.remove("hidden");
  actions.classList.remove("hidden");
};

// Reset geral
function resetar() {
  file.value = "";
  preview.innerHTML = "";
  preview.classList.add("hidden");
  actions.classList.add("hidden");
  form.classList.add("hidden");
  cameraChoice.classList.add("hidden");
  success.classList.add("hidden");
  welcome.classList.remove("hidden");
  progressBar.style.opacity = 0;
  progress.style.width = "0%";
}

// Confete 3D colorido com fade-out
function startConfetti3D(duration = 4000, fadeDuration = 1000) {
  const canvas = document.getElementById("confetti-canvas");
  const ctx = canvas.getContext("2d");
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  const colors = ["#6a4bc3","#9b6ef2","#ff5252","#ffb74d","#4caf50","#00bcd4","#ffc107","#e91e63"];
  const confettis = [];
  for (let i = 0; i < 200; i++) {
    confettis.push({
      x: Math.random()*canvas.width,
      y: Math.random()*canvas.height - canvas.height,
      z: Math.random()*20 + 5,
      size: Math.random()*8 + 4,
      color: colors[Math.floor(Math.random()*colors.length)],
      tilt: Math.random()*20,
      tiltAngle: Math.random()*2*Math.PI,
      tiltSpeed: Math.random()*0.1 + 0.05,
      speedY: Math.random()*3 + 2,
      speedX: Math.random()*2 - 1,
      rotation: Math.random()*2*Math.PI,
      rotationSpeed: Math.random()*0.2 - 0.1,
      alpha: Math.random()*0.5 + 0.5
    });
  }

  const startTime = Date.now();
  let fading = false;

  function draw() {
    const elapsed = Date.now() - startTime;

    if (elapsed > duration) fading = true; // come√ßa fade-out

    ctx.clearRect(0,0,canvas.width,canvas.height);
    confettis.forEach(c=>{
      const perspective = 500/(500+c.z);
      ctx.save();
      ctx.translate(c.x, c.y);
      ctx.rotate(c.tiltAngle);
      ctx.rotate(c.rotation);
      ctx.globalAlpha = fading ? Math.max(0, c.alpha * (1 - (elapsed - duration)/fadeDuration)) : c.alpha;
      ctx.fillStyle = c.color;
      ctx.fillRect(-c.size/2*perspective, -c.size/4*perspective, c.size*perspective, c.size/2*perspective);
      ctx.restore();
    });

    update();
    if (!fading || elapsed - duration < fadeDuration) {
      requestAnimationFrame(draw);
    } else {
      ctx.clearRect(0,0,canvas.width,canvas.height);
    }
  }

  function update() {
    confettis.forEach(c=>{
      c.tiltAngle += c.tiltSpeed;
      c.rotation += c.rotationSpeed;
      c.y += c.speedY;
      c.x += c.speedX;
      c.z -= 0.05;
      if(c.y>canvas.height || c.x<0 || c.x>canvas.width || c.z<0){
        c.x = Math.random()*canvas.width;
        c.y = -10;
        c.z = Math.random()*20 + 5;
        c.alpha = Math.random()*0.5+0.5;
      }
    });
  }

  draw();
}

// Envio com progresso e confete 3D com fade
form.onsubmit = (e) => {
  e.preventDefault();
  if (form.querySelector('input[name="_honey"]').value) return;

  const xhr = new XMLHttpRequest();
  xhr.open("POST", form.action);

  xhr.upload.onprogress = (e) => {
    if (e.lengthComputable) {
      progressBar.style.opacity = 1;
      let percent = (e.loaded / e.total) * 100;
      progress.style.width = percent + "%";
    }
  };

  xhr.onload = () => {
    progress.style.width = "100%";
    setTimeout(() => {
      progressBar.style.opacity = 0;
      form.classList.add("hidden");
      success.classList.remove("hidden");

      // Confete 3D colorido com fade-out
      startConfetti3D();

      // Reset ap√≥s 5s para dar tempo do fade-out terminar
      setTimeout(() => {
        resetar();
        window.scrollTo({ top: 0, behavior: "smooth" });
      }, 5000);
    }, 500);
  };

  xhr.send(new FormData(form));
};
</script>
</body>
</html>
